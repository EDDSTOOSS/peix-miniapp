<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>PeixPeix Shop</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  color: #ffd700;
  background: url("Derriere.png") no-repeat center center fixed;
  background-size: cover;
}

.header-fixed {
  position: fixed;
  top: 0;
  width: 100%;
  height: 120px;
  z-index: 1000;
  overflow: hidden;
  box-shadow: 0 12px 25px rgba(0, 0, 0, 0.55);
}

.header-fixed img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center -55px;
}

.header-fixed::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 50px;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.45) 60%, rgba(0, 0, 0, 0.75) 100%);
  pointer-events: none;
}

.app-overlay {
  min-height: 100vh;
  padding-top: 180px;
  width: 100%;
  max-width: none;
  margin: 0 auto;
}

.user-header {
  position: fixed;
  top: 120px;
  left: 0;
  right: 0;
  z-index: 999;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: linear-gradient(180deg, rgba(20,20,20,0.95), rgba(10,10,10,0.95));
  border-bottom: 1px solid rgba(255,255,255,0.08);
  width: 100%;
  box-sizing: border-box;
  backdrop-filter: blur(12px);
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.user-avatar {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  background: linear-gradient(135deg, #ffd700, #d4a700);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 800;
  color: #111;
  box-shadow: 0 0 12px rgba(255,215,0,0.4);
}

.user-details {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.user-name {
  font-size: 15px;
  font-weight: 700;
  color: #fff;
}

.user-id {
  font-size: 11px;
  font-weight: 500;
  color: rgba(255,255,255,0.5);
}

.user-balance {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: linear-gradient(135deg, #00ff9d, #00e68a);
  border-radius: 12px; /* <-- chang√© de 999px √† 12px */
  box-shadow: 0 0 24px rgba(0,255,157,0.65), 0 4px 12px rgba(0,230,138,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
}

.user-balance-amount {
  font-size: 16px;
  font-weight: 800;
  color: #111;
  letter-spacing: 0.3px;
}

.top-actions {
  display: flex;
  gap: 10px;
  margin: 12px 16px 10px;
}

.filters-box,
.stock-box {
  flex: 1;
  padding: 10px 16px;
  background: linear-gradient(180deg, rgba(20,20,20,0.95), rgba(10,10,10,0.95));
  border-radius: 12px; /* moins arrondi que 999px */
  font-size: 14px;
  font-weight: 600;
  color: #ffd700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
  transition: all 0.25s ease;
}

.filters-box:hover,
.stock-box:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 12px rgba(255,215,0,0.3), inset 0 1px 0 rgba(255,255,255,0.04);
}

.filter-icon {
  width: 18px;
  height: 18px;
  stroke-width: 2.5;
}

.filters-panel,
.stock-panel {
  display: none;
  margin: 12px 16px;
  padding: 16px;
  background: linear-gradient(180deg, rgba(40,40,40,0.95), rgba(26,26,26,0.95));
  border-radius: 14px; /* l√©g√®rement arrondi pour le style premium */
  border: 1px solid rgba(255,215,0,0.25); /* contour dor√© */
  box-shadow: 0 6px 18px rgba(0,0,0,0.55), 0 0 16px rgba(255,215,0,0.35);
  backdrop-filter: blur(8px);
}

.filters-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 14px;
}

.filter-item {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.filter-item label {
  font-size: 11px;
  font-weight: 600;
  color: #cfcfcf;
  letter-spacing: 0.4px;
}

.filter-item input, .filter-select {
  width: 100%;
  box-sizing: border-box;
  padding: 9px 10px;
  border-radius: 10px;
  background: rgba(15,15,15,0.9);
  border: 1px solid rgba(255,255,255,0.08);
  color: #ffd700;
  font-size: 13px;
}

.filter-select {
  cursor: pointer;
}

.filter-item input::placeholder {
  color: rgba(255,255,255,0.35);
}

.filter-item input:focus, .filter-select:focus {
  border-color: rgba(255,215,0,0.6);
  outline: none;
}

.range-filter {
  margin-bottom: 16px;
  width: 100%; /* prend toute la largeur du panel */
  box-sizing: border-box;
}

.range-filter label {
  display: block;
  font-size: 11px;
  font-weight: 600;
  color: #cfcfcf;
  letter-spacing: 0.4px;
  margin-bottom: 8px;
}

.range-inputs {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;      /* important */
  box-sizing: border-box;
}

.range-inputs input {
  flex: 1;                  /* prend la moiti√© de l'espace disponible */
  padding: 9px 10px;
  border-radius: 10px;
  background: rgba(15,15,15,0.9);
  border: 1px solid rgba(255,255,255,0.08);
  color: #ffd700;
  font-size: 13px;
  text-align: center;
  box-sizing: border-box;   /* inclus padding et border dans la largeur */
  min-width: 0;             /* important pour emp√™cher le d√©passement */
}

.range-inputs input::placeholder {
  color: rgba(255,255,255,0.35);
}

.range-inputs input:focus {
  border-color: rgba(255,215,0,0.6);
  outline: none;
}

.range-separator {
  color: rgba(255,255,255,0.5);
  font-weight: 600;
}

.apply-filters {
  width: 100%;
  padding: 12px;
  border-radius: 12px; /* plus carr√© que 999px */
  background: linear-gradient(135deg, #ffd700, #ffed4e); /* jaune vif */
  border: none;
  font-size: 14px;
  font-weight: 700;
  color: #111;
  cursor: pointer;
  box-shadow: 0 4px 14px rgba(255,215,0,0.5);
  transition: all 0.25s ease;
}

.apply-filters:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255,215,0,0.6);
}

.apply-filters:active {
  transform: scale(0.98);
}

.container {
  padding-top: 16px;
  padding-bottom: 50px;
}

#products {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  width: 100%;
  padding: 0 12px;
  box-sizing: border-box;
}

.product-card {
  width: 100%;
  padding: 8px 10px;
  max-width: 280px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  background: linear-gradient(180deg, rgba(30,25,10,0.95), rgba(15,12,5,0.95));
  border: 1px solid rgba(255,215,0,0.25);
  box-shadow: 0 6px 14px rgba(0,0,0,0.45);
  margin-bottom: 10px;
  min-height: 120px;
  transition: all 0.3s ease;
}

.product-card.in-cart {
  border: 2px solid #ffd700;
  box-shadow: 0 0 20px rgba(255,215,0,0.6), 0 6px 14px rgba(0,0,0,0.45);
  background: linear-gradient(180deg, rgba(40,35,15,0.95), rgba(25,20,8,0.95));
}

.card-image {
  width: 64px;
  height: 42px;
  border-radius: 8px;
  background: rgba(255,255,255,0.05);
  flex-shrink: 0;
}

.card-content {
  flex: 1;
  font-size: 13px;
  color: #ffd700;
}

.card-bin {
  font-size: 18px;
  font-weight: 800;
  margin-bottom: 6px;
}

.card-line {
  font-size: 12px;
  opacity: 0.9;
}

.card-line span {
  font-weight: 600;
}

.card-price {
  margin-top: 8px;
}

.card-price .price {
  font-size: 18px;
  font-weight: 800;
}

.add-btn {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  background: #000;
  color: #ffd700;
  font-size: 24px;
  border: none;
  cursor: pointer;
  box-shadow: 0 0 12px rgba(255,215,0,0.6);
  transition: all 0.3s ease;
}

.add-btn:hover {
  transform: scale(1.08);
}

.add-btn.in-cart-btn {
  background: linear-gradient(135deg, #ffd700, #ffed4e);
  color: #000;
  box-shadow: 0 0 16px rgba(255,215,0,0.8);
  font-size: 28px;
}

/* ========== PAGINATION CRONOS STYLE ========== */
#pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 3px;
  margin-top: 14px;
  padding: 0 16px;
}

.page-nav-btn {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #2e2e3a;
  border: none;
  border-radius: 6px;
  color: #fff;
  cursor: pointer;
  transition: background 0.2s;
}

.page-nav-btn:hover:not(:disabled) {
  background: #3a3a4a;
}

.page-nav-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.nav-icon {
  width: 11px;
  height: 11px;
  stroke-width: 2.5;
}

.page-box {
  min-width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 3px;
  background: #2e2e3a;
  border: none;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  color: #fff;
  cursor: pointer;
  transition: background 0.2s;
}

.page-box:hover:not(.active) {
  background: #3a3a4a;
}

.page-box.active {
  background: linear-gradient(135deg, #ffed4e, #ffd700);
  color: #000;
  cursor: default;
  font-weight: 800;
  box-shadow: 0 0 8px rgba(255, 237, 78, 0.5), 0 0 12px rgba(255, 215, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

.page-dots {
  color: rgba(255,255,255,0.4);
  font-size: 11px;
  font-weight: 700;
  user-select: none;
  padding: 0 1px;
}

.page-info {
  text-align: center;
  margin-top: 6px;
  font-size: 10px;
  font-weight: 500;
  color: #ffd700;
  letter-spacing: 0.2px;
}

.bottom-nav {
  position: fixed;
  bottom: 0;
  width: 100%;
  height: 78px;
  background: rgba(20,20,20,0.55);
  backdrop-filter: blur(22px);
  display: flex;
  border-top: 1px solid rgba(255,255,255,0.08);
  left: 0;
  right: 0;
}

.bottom-nav button {
  flex: 1;
  background: none;
  border: none;
  color: #ffd700;
  opacity: 0.55;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
  cursor: pointer;
  transition: all 0.25s ease;
}

.bottom-nav button:hover, .bottom-nav button.active {
  opacity: 1;
  transform: translateY(-2px);
}

.bottom-nav .icon {
  width: 22px;
  height: 22px;
  stroke-width: 2.2;
}

.bottom-nav button:hover .icon, .bottom-nav button.active .icon {
  filter: drop-shadow(0 0 6px rgba(255,215,0,0.7));
}

.bottom-nav .label {
  font-size: 11px;
  font-weight: 600;
}

.cart-icon-wrapper {
  position: relative;
}

.cart-badge {
  position: absolute;
  top: -8px;
  right: -12px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #ff0000;
  color: #fff;
  font-size: 11px;
  font-weight: 800;
  display: none;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 12px rgba(255,0,0,0.8), 0 2px 6px rgba(0,0,0,0.4);
}

.cart-pay-btn {
  width: 100%;
  padding: 14px;
  border-radius: 999px;
  background: linear-gradient(180deg, #ffeaa0, #d4a700);
  border: none;
  font-size: 16px;
  font-weight: 800;
  color: #111;
  cursor: pointer;
}

.cart-container {
  background: linear-gradient(180deg, rgba(30,30,30,0.95), rgba(20,20,20,0.95));
  border-radius: 18px;
  padding: 20px;
  border: 2px solid #ffd700;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4), 0 0 20px rgba(255,215,0,0.5), inset 0 1px 0 rgba(255,215,0,0.2);
  backdrop-filter: blur(12px);
}

.cart-header {
  margin-bottom: 16px;
  padding-bottom: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.cart-title {
  font-size: 20px;
  font-weight: 800;
  color: #ffd700;
  letter-spacing: 0.5px;
}

.cart-product-item {
  position: relative;
  background: linear-gradient(180deg, rgba(40,35,20,0.9), rgba(25,22,12,0.9));
  border-radius: 12px;
  padding: 16px;
  border: 1px solid rgba(255,215,0,0.15);
  margin-bottom: 12px;
}

.remove-item-cart {
  position: absolute;
  top: 12px;
  right: 12px;
  background: rgba(255,255,255,0.08);
  border: none;
  color: #ff4d4d;
  font-size: 13px;
  font-weight: 700;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.remove-item-cart:hover {
  background: rgba(255,77,77,0.2);
  transform: scale(1.1);
}

.cart-product-info {
  margin-bottom: 10px;
}

.cart-product-name {
  font-size: 16px;
  font-weight: 700;
  color: #ffd700;
  margin-bottom: 4px;
}

.cart-product-desc {
  font-size: 12px;
  color: rgba(255,255,255,0.5);
}

.cart-product-price {
  font-size: 16px;
  font-weight: 700;
  color: #fff;
  text-align: right;
}

.cart-divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,215,0,0.3), transparent);
  margin: 16px 0;
}

.cart-total {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 16px;
  background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,215,0,0.08));
  border-radius: 10px;
  border: 1px solid rgba(255,215,0,0.25);
  margin-bottom: 16px;
}

.cart-total-label {
  font-size: 16px;
  font-weight: 700;
  color: #ffd700;
  letter-spacing: 0.5px;
}

.cart-total-amount {
  font-size: 22px;
  font-weight: 800;
  color: #00ff9d;
  text-shadow: 0 0 8px rgba(0,255,157,0.4);
}

.cart-footer {
  margin-top: 8px;
}

.cart-pay-btn-new {
  width: 100%;
  padding: 14px 20px;
  border-radius: 12px;
  background: linear-gradient(135deg, #00ff9d, #00e68a);
  border: none;
  font-size: 15px;
  font-weight: 700;
  color: #111;
  cursor: pointer;
  box-shadow: 0 4px 14px rgba(0,255,157,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
  transition: all 0.25s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cart-pay-btn-new:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,255,157,0.5), inset 0 1px 0 rgba(255,255,255,0.3);
}

.cart-pay-btn-new:active {
  transform: scale(0.98);
}

.success-container {
  background: linear-gradient(180deg, rgba(30,30,30,0.95), rgba(20,20,20,0.95));
  border-radius: 18px;
  padding: 30px 20px;
  border: 2px solid #00ff9d;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4), 0 0 20px rgba(0,255,157,0.4);
  backdrop-filter: blur(12px);
  text-align: center;
}

.success-icon {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #00ff9d, #00e68a);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: 800;
  color: #111;
  margin: 0 auto 20px;
  box-shadow: 0 4px 14px rgba(0,255,157,0.5);
}

.success-title {
  font-size: 20px;
  font-weight: 800;
  color: #00ff9d;
  margin-bottom: 12px;
  letter-spacing: 0.5px;
}

.success-text {
  font-size: 14px;
  color: rgba(255,255,255,0.7);
  line-height: 1.5;
  margin-bottom: 24px;
}

.success-btn {
  width: 100%;
  padding: 14px 20px;
  border-radius: 12px;
  background: linear-gradient(135deg, #ffd700, #ffed4e);
  border: none;
  font-size: 15px;
  font-weight: 700;
  color: #111;
  cursor: pointer;
  box-shadow: 0 4px 14px rgba(255,215,0,0.4);
  transition: all 0.25s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.success-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255,215,0,0.5);
}

.success-btn:active {
  transform: scale(0.98);
}

.history-header {
  font-size: 20px;
  font-weight: 800;
  color: #ffd700;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  letter-spacing: 0.5px;
}

.order-card {
  background: linear-gradient(180deg, rgba(30,30,30,0.95), rgba(20,20,20,0.95));
  border-radius: 16px;
  padding: 18px;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
  backdrop-filter: blur(12px);
  margin-bottom: 16px;
}

.order-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 14px;
}

.order-info {
  flex: 1;
}

.order-id {
  font-size: 16px;
  font-weight: 700;
  color: #ffd700;
  margin-bottom: 4px;
}

.order-date {
  font-size: 12px;
  color: rgba(255,255,255,0.5);
}

.order-status {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
}

.order-status.valid {
  background: rgba(0,255,157,0.15);
  color: #00ff9d;
  border: 1px solid rgba(0,255,157,0.3);
}

.order-divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  margin: 12px 0;
}

.order-items {
  margin: 12px 0;
}

.order-item-line {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  font-size: 14px;
  color: rgba(255,255,255,0.8);
}

.order-total {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 15px;
  font-weight: 700;
  color: #ffd700;
  padding-top: 4px;
}

.order-total-price {
  font-size: 18px;
  color: #00ff9d;
  font-weight: 800;
}

.order-details-btn {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  border-radius: 10px;
  background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,215,0,0.08));
  border: 1px solid rgba(255,215,0,0.3);
  color: #ffd700;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.25s ease;
}

.order-details-btn:hover {
  background: linear-gradient(135deg, rgba(255,215,0,0.25), rgba(255,215,0,0.15));
  transform: translateY(-2px);
}

.order-details-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(8px);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal-content {
  background: linear-gradient(180deg, rgba(30,30,30,0.98), rgba(20,20,20,0.98));
  border-radius: 18px;
  padding: 24px;
  border: 2px solid #ffd700;
  max-width: 320px;
  width: 90%;
  max-height: 70vh;
  overflow-y: auto;
  position: relative;
}

.modal-close {
  position: absolute;
  top: 12px;
  right: 12px;
  background: rgba(255,255,255,0.1);
  border: none;
  color: #fff;
  font-size: 20px;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  cursor: pointer;
}

.download-btn {
  width: 100%;
  padding: 12px;
  margin-top: 16px;
  border-radius: 12px;
  background: linear-gradient(135deg, #00ff9d, #00e68a);
  border: none;
  font-size: 14px;
  font-weight: 700;
  color: #111;
  cursor: pointer;
}

.cart-item {
  position: relative;
}

.remove-item {
  position: absolute;
  top: 10px;
  right: 12px;
  background: rgba(255, 255, 255, 0.08);
  border: none;
  color: #ff4d4d;
  font-size: 14px;
  font-weight: 800;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  cursor: pointer;
}

.back-btn {
  background: none;
  border: none;
  color: #ffd700;
  font-size: 14px;
  font-weight: 700;
  margin: 12px 0;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="header-fixed">
  <img src="backround.png" alt="Header PeixPeix">
</div>

<div class="user-header">
  <div class="user-info">
    <div class="user-avatar">P</div>
    <div class="user-details">
      <div class="user-name">PeixUser</div>
      <div class="user-id">ID: 1234567890</div>
    </div>
  </div>
  <div class="user-balance">
    <div class="user-balance-amount">10000‚Ç¨</div>
  </div>
</div>

<div id="cart-page" style="display:none" class="app-overlay">
  <div style="padding:16px 16px 100px 16px; max-width: 400px; margin: 0 auto;">
    <div class="cart-container">
      <div class="cart-header">
        <div class="cart-title">
          <i data-lucide="shopping-cart" style="width:20px;height:20px;stroke-width:2.5;vertical-align:middle;margin-right:8px;"></i>
          Panier
        </div>
      </div>
      
      <div id="cart-content" style="display:none">
        <div id="cart-items-container"></div>
        
        <div class="cart-divider"></div>
        
        <div class="cart-total">
          <div class="cart-total-label">Total</div>
          <div class="cart-total-amount" id="cart-total">0‚Ç¨</div>
        </div>
      </div>
      
      <div id="empty-cart-msg" style="text-align:center; padding:30px 20px; color:rgba(255,255,255,0.4); font-size:14px;">
        Votre panier est vide
      </div>
      
      <div class="cart-footer">
        <button class="cart-pay-btn-new" id="pay-btn" style="display:none" onclick="processPayment()">
          <i data-lucide="credit-card" style="width:18px;height:18px;stroke-width:2.5;vertical-align:middle;margin-right:6px;"></i>
          <span>Payer</span>
        </button>
      </div>
    </div>
    
    <div id="success-message" style="display:none" class="success-container">
      <div class="success-icon">‚úì</div>
      <div class="success-title">Merci pour votre achat !</div>
      <div class="success-text">Rendez-vous dans l'historique pour retrouver votre commande</div>
      <button class="success-btn" onclick="goToHistory()">
        <i data-lucide="receipt" style="width:18px;height:18px;stroke-width:2.5;vertical-align:middle;margin-right:6px;"></i>
        Voir l'historique
      </button>
    </div>
  </div>
</div>

<div class="header-fixed">
  <img src="backround.png" alt="Header PeixPeix">
</div>

<div id="shop-page" class="app-overlay">

  <div class="top-actions">
  <div class="filters-box" onclick="toggleFilters()">
    <i data-lucide="sliders-horizontal" class="filter-icon"></i>
    <span>Filtres</span>
  </div>

  <div class="filters-box" onclick="toggleStock()" style="margin-left:8px;">
    <i data-lucide="archive" class="filter-icon"></i>
    <span>Stock</span>
  </div>
</div>

<!-- STOCK PANEL -->
<div class="filters-panel" id="stock-panel" style="display:none;">
  <div style="display:flex; flex-direction:column; gap:6px; font-size:13px; color:#ffd700; line-height:1.4;">
    <span id="stock-classic">CLASSIC : 23</span>
    <span id="stock-gold">GOLD : 20</span>
    <span id="stock-infinite">INFINITE : 6</span>
    <span id="stock-unknown">UNKNOWN : 8</span>
  </div>
</div>

  <div class="filters-panel" id="filters">
    <div class="filters-grid">
      <div class="filter-item">
        <label>BIN</label>
        <input type="text" placeholder="Ex: 457173">
      </div>
      <div class="filter-item">
        <label>Banque</label>
        <select class="filter-select">
          <option value="">Toutes</option>
          <option value="banque_federative">BANQUE FEDERATIVE DU CREDIT MUTUEL (BFCM)</option>
          <option value="bnp">BNP PARIBAS</option>
          <option value="boursorama">BOURSORAMA BANQUE</option>
          <option value="bpce">BPCE</option>
          <option value="credit_agricole">CREDIT AGRICOLE S.A.</option>
          <option value="credit_agricole_sa">CREDIT AGRICOLE SOCIETE ANONYME</option>
          <option value="credit_lyonnais">LE CREDIT LYONNAIS</option>
          <option value="lyonnaise">LYONNAISE DE BANQUE</option>
          <option value="revolut">REVOLUT LTD</option>
          <option value="societe_generale">SOCIETE GENERAL, S.A.</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Base</label>
        <select class="filter-select">
          <option value="">Toutes</option>
          <option value="mondial">Mondial Relay</option>
          <option value="ame">Amelie</option>
          <option value="ulys">Ulys</option>
          <option value="sncf">SNCF</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Code postal</label>
        <input type="text" placeholder="Ex: 75">
      </div>
    </div>

    <div class="range-filter">
      <label>√Çge</label>
      <div class="range-inputs">
        <input type="number" placeholder="Min" min="18" max="99">
        <span class="range-separator">-</span>
        <input type="number" placeholder="Max" min="18" max="99">
      </div>
    </div>

    <div class="range-filter">
      <label>Prix</label>
      <div class="range-inputs">
        <input type="number" placeholder="Min" min="0">
        <span class="range-separator">-</span>
        <input type="number" placeholder="Max" min="0">
      </div>
    </div>

    <button class="apply-filters">Appliquer les filtres</button>
  </div>

  <div class="container">
    <div id="products"></div>
    <div id="pagination"></div>
    <div id="page-info" class="page-info"></div>
  </div>

</div>

<div id="history-page" style="display:none" class="app-overlay">
  <div style="padding:16px 16px 100px 16px; max-width: 400px; margin: 0 auto;">

    <!-- ‚úÖ CADRE PRINCIPAL HISTORIQUE -->
    <div class="cart-container">

      <div class="cart-header">
        <div class="cart-title">
          <i data-lucide="receipt" style="width:20px;height:20px;stroke-width:2.5;vertical-align:middle;margin-right:8px;"></i>
          Historique des commandes
        </div>
      </div>

      <div id="history-content">
        <!-- Commande 1 -->
        <div class="order-card">
          <button class="order-details-btn" onclick="showOrderDetails(1234)">
  D√©tails de la commande
</button>
          <div class="order-header">
            <div class="order-info">
              <div class="order-id">Commande #1234</div>
              <div class="order-date">23 janvier 2026 - 14:30</div>
            </div>
            <div class="order-status valid">
              <i data-lucide="check-circle" style="width:20px;height:20px;stroke-width:2.5;"></i>
              <span>Valid√©e</span>
            </div>
          </div>

          <div class="order-divider"></div>

          <div class="order-items">
            <div class="order-item-line">
              <span>2√ó CLASSIC</span>
              <span>60‚Ç¨</span>
            </div>
            <div class="order-item-line">
              <span>1√ó GOLD</span>
              <span>45‚Ç¨</span>
            </div>
          </div>

          <div class="order-divider"></div>

          <div class="order-total">
            <span>Total</span>
            <span class="order-total-price">105‚Ç¨</span>
          </div>
        </div>

        <!-- Commande 2 -->
        <div class="order-card">
          <button class="order-details-btn" onclick="showOrderDetails(1234)">
  D√©tails de la commande
</button>
          <div class="order-header">
            <div class="order-info">
              <div class="order-id">Commande #1233</div>
              <div class="order-date">22 janvier 2026 - 10:15</div>
            </div>
            <div class="order-status valid">
              <i data-lucide="check-circle" style="width:20px;height:20px;stroke-width:2.5;"></i>
              <span>Valid√©e</span>
            </div>
          </div>

          <div class="order-divider"></div>

          <div class="order-items">
            <div class="order-item-line">
              <span>1√ó INFINITE</span>
              <span>100‚Ç¨</span>
            </div>
          </div>

          <div class="order-divider"></div>

          <div class="order-total">
            <span>Total</span>
            <span class="order-total-price">100‚Ç¨</span>
          </div>
        </div>
      </div>

      <div id="empty-history" style="display:none; text-align:center; padding:40px 20px; color:rgba(255,255,255,0.4); font-size:14px;">
        Aucune commande pour le moment
      </div>

    </div>
    <!-- ‚úÖ FIN CADRE PRINCIPAL -->

  </div>
</div>
    
    <div id="empty-history" style="display:none; text-align:center; padding:40px 20px; color:rgba(255,255,255,0.4); font-size:14px;">
      Aucune commande pour le moment
    </div>
  </div>
</div>

<div class="bottom-nav">
  <button onclick="openShop()" id="nav-shop" class="active">
    <i data-lucide="store" class="icon"></i>
    <span class="label">Boutique</span>
  </button>
  <button onclick="openCart()" id="nav-cart">
    <div class="cart-icon-wrapper">
      <i data-lucide="shopping-cart" class="icon"></i>
      <div id="cart-badge" class="cart-badge">1</div>
    </div>
    <span class="label">Panier</span>
  </button>
  <button onclick="openHistory()" id="nav-history">
    <i data-lucide="receipt" class="icon"></i>
    <span class="label">Historique</span>
  </button>
</div>

<button class="back-btn" onclick="openShop()">‚Üê Retour √† la boutique</button>

<div id="order-modal" class="order-details-modal" onclick="if(event.target===this) closeOrderDetails()">
  <div class="modal-content">
    <button class="modal-close" onclick="closeOrderDetails()">‚úï</button>
    <div id="modal-content-inner"></div>
  </div>
</div>

<script>
try {
  Telegram.WebApp.expand();
} catch(e) {
  console.log("Telegram WebApp non disponible");
}

const isMobile = window.innerWidth < 768;
document.body.classList.add(isMobile ? "mobile" : "desktop");

function toggleFilters() {
  const f = document.getElementById("filters");
  f.style.display = f.style.display === "block" ? "none" : "block";
}

lucide.createIcons();
</script>

<script>
const PRODUCTS_PER_PAGE = 6;
let currentPage = 1;
let cartCount = 0;
let cartItems = [];

const products = [
  { id: 1, bin: "444111", type: "DEBIT", level: "CLASSIC", bank: "MONOBANK", city: "LIMOGES", price: 30 },
  { id: 2, bin: "457173", type: "CREDIT", level: "GOLD", bank: "BNP PARIBAS", city: "PARIS", price: 45 },
  { id: 3, bin: "523456", type: "DEBIT", level: "INFINITE", bank: "CREDIT AGRICOLE", city: "LYON", price: 100 },
  { id: 4, bin: "489321", type: "DEBIT", level: "CLASSIC", bank: "BOURSORAMA", city: "MARSEILLE", price: 30 },
  { id: 5, bin: "512789", type: "CREDIT", level: "GOLD", bank: "REVOLUT", city: "TOULOUSE", price: 45 },
  { id: 6, bin: "478965", type: "DEBIT", level: "CLASSIC", bank: "SOCIETE GENERALE", city: "NICE", price: 30 },
  { id: 7, bin: "534821", type: "CREDIT", level: "INFINITE", bank: "BPCE", city: "BORDEAUX", price: 100 },
  { id: 8, bin: "456123", type: "DEBIT", level: "GOLD", bank: "CREDIT LYONNAIS", city: "NANTES", price: 45 },
  { id: 9, bin: "498732", type: "CREDIT", level: "CLASSIC", bank: "MONOBANK", city: "STRASBOURG", price: 30 },
  { id: 10, bin: "523987", type: "DEBIT", level: "INFINITE", bank: "BNP PARIBAS", city: "LILLE", price: 100 },
  { id: 11, bin: "445678", type: "CREDIT", level: "GOLD", bank: "BOURSORAMA", city: "RENNES", price: 45 },
  { id: 12, bin: "512456", type: "DEBIT", level: "CLASSIC", bank: "REVOLUT", city: "REIMS", price: 30 },
  { id: 13, bin: "478123", type: "CREDIT", level: "INFINITE", bank: "CREDIT AGRICOLE", city: "PARIS", price: 100 },
  { id: 14, bin: "534987", type: "DEBIT", level: "GOLD", bank: "SOCIETE GENERALE", city: "LYON", price: 45 },
  { id: 15, bin: "456789", type: "CREDIT", level: "CLASSIC", bank: "BPCE", city: "MARSEILLE", price: 30 },
  { id: 16, bin: "498456", type: "DEBIT", level: "INFINITE", bank: "MONOBANK", city: "TOULOUSE", price: 100 },
  { id: 17, bin: "523654", type: "CREDIT", level: "GOLD", bank: "BNP PARIBAS", city: "NICE", price: 45 },
  { id: 18, bin: "445321", type: "DEBIT", level: "CLASSIC", bank: "BOURSORAMA", city: "BORDEAUX", price: 30 }
];

function renderProducts() {
  const start = (currentPage - 1) * PRODUCTS_PER_PAGE;
  const end = start + PRODUCTS_PER_PAGE;
  const pageProducts = products.slice(start, end);

  const container = document.getElementById("products");
  container.innerHTML = "";

  pageProducts.forEach(p => {
    const isInCart = cartItems.find(item => item.id === p.id);
    const inCartClass = isInCart ? 'in-cart' : '';
    
    container.innerHTML += `
      <div class="product-card ${inCartClass}" data-product-id="${p.id}">
        <div class="card-image"></div>
        <div class="card-content">
          <div class="card-bin">${p.bin}</div>
          <div class="card-line">üí≥ Type : ${p.type}</div>
          <div class="card-line">‚≠ê Level : ${p.level}</div>
          <div class="card-line">üè¶ Banque : ${p.bank}</div>
          <div class="card-line">üìç Ville : ${p.city}</div>
          <div class="card-price"><span class="price">${p.price}‚Ç¨</span></div>
        </div>
        <button class="add-btn ${isInCart ? 'in-cart-btn' : ''}" onclick="toggleCart(${p.id}, '${p.level}', ${p.price})">${isInCart ? '‚àí' : '+'}</button>
      </div>
    `;
  });
}

function renderPagination() {
  const totalPages = Math.ceil(products.length / PRODUCTS_PER_PAGE);
  const pagination = document.getElementById("pagination");

  pagination.innerHTML = `
    <button class="page-nav-btn" onclick="prevPage()" ${currentPage === 1 ? "disabled" : ""}>
      <i data-lucide="chevron-left" class="nav-icon"></i>
    </button>

    <div class="page-box ${currentPage === 1 ? 'active' : ''}" onclick="goToPage(1)">1</div>
    <div class="page-box ${currentPage === 2 ? 'active' : ''}" onclick="goToPage(2)">2</div>
    <div class="page-box ${currentPage === 3 ? 'active' : ''}" onclick="goToPage(3)">3</div>
    <div class="page-dots">...</div>
    <div class="page-box ${currentPage === totalPages ? 'active' : ''}" onclick="goToPage(${totalPages})">${totalPages}</div>

    <button class="page-nav-btn" onclick="nextPage()" ${currentPage === totalPages ? "disabled" : ""}>
      <i data-lucide="chevron-right" class="nav-icon"></i>
    </button>
  `;
  
  lucide.createIcons();
}

function renderPageInfo() {
  const totalPages = Math.ceil(products.length / PRODUCTS_PER_PAGE);
  const pageInfo = document.getElementById("page-info");
  if (pageInfo) {
    pageInfo.textContent = `Page ${currentPage} sur ${totalPages}`;
  }
}

function nextPage() {
  const totalPages = Math.ceil(products.length / PRODUCTS_PER_PAGE);
  if (currentPage < totalPages) {
    currentPage++;
    renderProducts();
    renderPagination();
    renderPageInfo();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
}

function prevPage() {
  if (currentPage > 1) {
    currentPage--;
    renderProducts();
    renderPagination();
    renderPageInfo();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
}

function goToPage(page) {
  const totalPages = Math.ceil(products.length / PRODUCTS_PER_PAGE);
  if (page !== currentPage && page >= 1 && page <= totalPages) {
    currentPage = page;
    renderProducts();
    renderPagination();
    renderPageInfo();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
}

renderProducts();
renderPagination();
renderPageInfo();
</script>

<script>
function addToCart(productId, productName, productPrice) {
  // V√©rifier si le produit est d√©j√† dans le panier
  const alreadyInCart = cartItems.find(item => item.id === productId);
  
  if (alreadyInCart) {
    return;
  }
  
  // R√©cup√©rer les infos compl√®tes du produit
  const product = products.find(p => p.id === productId);
  
  cartItems.push({ 
    id: productId, 
    name: productName, 
    price: productPrice,
    bin: product.bin,
    bank: product.bank
  });
  cartCount++;
  
  const badge = document.getElementById("cart-badge");
  badge.style.display = "flex";
  badge.textContent = cartCount;
  
  updateCartDisplay();
}

function toggleCart(productId, productName, productPrice) {
  const alreadyInCart = cartItems.find(item => item.id === productId);
  
  if (alreadyInCart) {
    // Retirer du panier
    cartItems = cartItems.filter(item => item.id !== productId);
    cartCount--;
  } else {
    // Ajouter au panier
    const product = products.find(p => p.id === productId);
    cartItems.push({ 
      id: productId, 
      name: productName, 
      price: productPrice,
      bin: product.bin,
      bank: product.bank
    });
    cartCount++;
  }
  
  const badge = document.getElementById("cart-badge");
  if (cartCount === 0) {
    badge.style.display = "none";
  } else {
    badge.style.display = "flex";
    badge.textContent = cartCount;
  }
  
  updateCartDisplay();
}

function updateCartDisplay() {
  const cartContent = document.getElementById("cart-content");
  const emptyMsg = document.getElementById("empty-cart-msg");
  const payBtn = document.getElementById("pay-btn");
  const cartItemsContainer = document.getElementById("cart-items-container");
  
  if (cartItems.length === 0) {
    cartContent.style.display = "none";
    emptyMsg.style.display = "block";
    payBtn.style.display = "none";
  } else {
    cartContent.style.display = "block";
    emptyMsg.style.display = "none";
    payBtn.style.display = "flex";
    
    // Grouper les produits par niveau (CLASSIC, GOLD, INFINITE)
    const grouped = {};
    cartItems.forEach(item => {
      if (!grouped[item.name]) {
        grouped[item.name] = [];
      }
      grouped[item.name].push(item);
    });
    
    // G√©n√©rer le HTML pour chaque groupe
    cartItemsContainer.innerHTML = "";
    Object.keys(grouped).forEach(level => {
      const items = grouped[level];
      const totalPrice = items.reduce((sum, item) => sum + item.price, 0);
      
      // Cr√©er la liste des BIN/Banque
      const binList = items.map(item => `BIN: ${item.bin} - ${item.bank}`).join('<br>');
      
      cartItemsContainer.innerHTML += `
        <div class="cart-product-item">
          <button class="remove-item-cart" onclick="removeGroup('${level}')">‚úï</button>
          <div class="cart-product-info">
            <div class="cart-product-name">${items.length}√ó ${level}</div>
            <div class="cart-product-desc">${binList}</div>
          </div>
          <div class="cart-product-price">${totalPrice}‚Ç¨</div>
        </div>
      `;
    });
    
    // Calculer le total
    let total = cartItems.reduce((sum, item) => sum + item.price, 0);
    
    // Afficher le total
    document.getElementById("cart-total").textContent = total + "‚Ç¨";
  }
  
  // Mettre √† jour les cartes produits s√©lectionn√©es
  updateProductCards();
}

function goToHistory() {
  // Vider le panier
  cartItems = [];
  cartCount = 0;
  document.getElementById("cart-badge").style.display = "none";
  
  // Masquer le message de succ√®s
  document.getElementById("success-message").style.display = "none";
  document.getElementById("empty-cart-msg").style.display = "block";
  
  // Aller sur la page historique
  openHistory();
  updateCartDisplay();
}

function processPayment() {
  // Cacher le contenu du panier et afficher le message de succ√®s
  const cartContainer = document.querySelector(".cart-container");
  const successMsg = document.getElementById("success-message");
  
  if (cartContainer) cartContainer.style.display = "none";
  if (successMsg) {
    successMsg.style.display = "block";
    // R√©initialiser les ic√¥nes apr√®s l'affichage
    setTimeout(() => {
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }, 50);
  }
}

function openCart() {
  document.getElementById("shop-page").style.display = "none";
  document.getElementById("history-page").style.display = "none";
  document.getElementById("cart-page").style.display = "block";

  // ‚úÖ CORRECTION : r√©afficher le panier apr√®s un paiement
  const cartContainer = document.querySelector(".cart-container");
  if (cartContainer) cartContainer.style.display = "block";

  setActiveNav("cart");
}

function openShop() {
  document.getElementById("cart-page").style.display = "none";
  document.getElementById("history-page").style.display = "none";
  document.getElementById("shop-page").style.display = "block";
  setActiveNav("shop");
}

function removeFromCart(itemIndex) {
  cartItems.splice(itemIndex, 1);
  cartCount = cartItems.length;
  
  const badge = document.getElementById("cart-badge");
  if (cartCount === 0) {
    badge.style.display = "none";
  } else {
    badge.textContent = cartCount;
  }
  
  updateCartDisplay();
}

function removeGroup(level) {
  cartItems = cartItems.filter(item => item.name !== level);
  cartCount = cartItems.length;
  
  const badge = document.getElementById("cart-badge");
  if (cartCount === 0) {
    badge.style.display = "none";
  } else {
    badge.textContent = cartCount;
  }
  
  updateCartDisplay();
}

function updateProductCards() {
  const productCards = document.querySelectorAll('.product-card');
  productCards.forEach(card => {
    card.classList.remove('in-cart');
  });
  
  // Marquer les produits dans le panier
  cartItems.forEach(item => {
    const productCard = document.querySelector(`.product-card[data-product-id="${item.id}"]`);
    if (productCard) {
      productCard.classList.add('in-cart');
    }
  });
}

function setActiveNav(active) {
  document.querySelectorAll(".bottom-nav button").forEach(b => b.classList.remove("active"));
  document.getElementById("nav-" + active).classList.add("active");
}

function openHistory() {
  // cacher toutes les pages
  document.querySelectorAll('.app-overlay').forEach(el => {
    el.style.display = 'none';
  });

  // afficher l‚Äôhistorique
  const historyPage = document.getElementById('history-page');
  if (historyPage) {
    historyPage.style.display = 'block';
  }

  // optionnel : activer le bouton nav
  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.classList.remove('active');
  });

  const navHistory = document.getElementById('nav-history');
  if (navHistory) {
    navHistory.classList.add('active');
  }
}

function toggleStock() {
  const panel = document.getElementById("stock-panel");
  panel.style.display = panel.style.display === "block" ? "none" : "block";
}

function showOrderDetails(orderId) {
  const modal = document.getElementById('order-modal');
  const content = document.getElementById('modal-content-inner');
  
  content.innerHTML = `
    <h3 style="color:#ffd700; margin-bottom:16px;">Commande #${orderId}</h3>
    <div style="background:rgba(40,35,20,0.9); padding:16px; border-radius:12px; margin-bottom:12px;">
      <div style="font-size:14px; color:#ffd700; margin-bottom:8px; font-weight:700;">Produit CLASSIC</div>
      <div style="font-size:12px; color:rgba(255,255,255,0.7); margin-bottom:4px;">BIN: 444111</div>
      <div style="font-size:12px; color:rgba(255,255,255,0.7); margin-bottom:4px;">Banque: MONOBANK</div>
      <div style="font-size:12px; color:rgba(255,255,255,0.7); margin-bottom:4px;">Type: DEBIT</div>
      <div style="font-size:12px; color:rgba(255,255,255,0.7);">Ville: LIMOGES</div>
    </div>
    <button class="download-btn" onclick="downloadProduct()">
      üì• T√©l√©charger
    </button>
  `;
  
  modal.style.display = 'flex';
}

function closeOrderDetails() {
  document.getElementById('order-modal').style.display = 'none';
}

function downloadProduct() {
  alert('T√©l√©chargement du produit...');
}

</script>

</body>
</html>
